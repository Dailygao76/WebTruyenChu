<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://fonts.googleapis.com/css?family=Source Sans Pro' rel='stylesheet'>
    <style>
        *{
            font-family: 'Source Sans Pro';
        }
        caption{
            margin: 0px 30px 30px 30px;
        }

        #mucgia{
            height: 25px;
            border-radius: 10px;
            border: 1px solid rgb(208, 208, 208);
        }
        .container{    
            background-color: #f7f5f0;
            width: 700px;
            margin: 100px auto auto auto;
            padding: 20px;
            font-size: 1.2em;
        }
        table{
            width: 100%;
            height: 400px;
            border-collapse: collapse;
        }
        th, td{
            border: 1px solid black;
            padding:  6px;
            text-align: center;
        }
        caption{
            font-weight: 600;
            font-size: 1.2em;
        }
        .soluong{
            border: 1px solid black;
        }
        .hideqty-after{
            opacity: 0.5; /* Điều chỉnh giá trị opacity tùy thích */
            pointer-events: none; /* Ngăn các sự kiện click hoặc hover trên phần tử */
        }
    </style>

    <script>
        function tinhtien() {
            var nf = new Intl.NumberFormat();
            var Dongia = document.getElementsByClassName("dongia");
            var Soluong = document.getElementsByClassName("soluong");
            var sotien_arr = document.getElementsByClassName("tien");
        

            var tongdongia = 0,
                tongsoluong = 0,
                tongtien = 0;
                for (var i = 0; i < sotien_arr.length; i++) {
                    var sotien = sotien_arr[i].innerText;
                    sotien = parseInt(sotien);
                    tongtien += sotien;
                }
               
                document.getElementById("tongtien").innerText = nf.format(tongtien);
              
        }

        function daott(obj) {
            var nf = new Intl.NumberFormat();
            var row = obj.parentElement.parentElement;
            var soluong = row.querySelector('.soluong');

            var tien = row.querySelector('.tien');

            var isChecked;

            if (isChecked = obj.checked) {
                soluong.setAttribute('contenteditable', 'true');
                soluong.classList.remove("hideqty-after");
                tinhtien();
            } else {
                soluong.setAttribute('contenteditable', 'false');
                soluong.classList.add("hideqty-after");
                tien.innerText=0;
                soluong.innerText=0;
                tinhtien();
            }
        }

    
        function tien(element) {
            var nf = new Intl.NumberFormat();
            var row = element.parentNode.parentNode;
            var dongia = row.querySelector('.dongia').innerText;
            var soluong = row.querySelector('.soluong').innerText;
            var tien = dongia * soluong;
            row.querySelector('.tien').innerText = tien;
            tinhtien();
        }

        function locSanPhamTheoGia() {
            var mucGiaSelect = document.getElementById("mucgia");
            var selectedMucGia = mucGiaSelect.value;

            var rows = document.getElementsByTagName("tr");
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var giaElement = row.querySelector(".dongia");
                if (giaElement) {
                    var gia = parseInt(giaElement.innerText);

                    // Kiểm tra giá sản phẩm và hiển thị/ẩn mặt hàng dựa trên mức giá được chọn
                    if (selectedMucGia === "all" || (selectedMucGia === "duoi500k" && gia < 500000) ||
                        (selectedMucGia === "tu500kden1tr" && gia >= 500000 && gia <= 1000000) ||
                        (selectedMucGia === "tren1tr" && gia > 1000000)) {
                        row.style.display = "table-row";
                        resetTongTienVaSoLuong();
                    } else {
                        row.style.display = "none";
                        resetTongTienVaSoLuong();
                    }
                }
            }
        }

        function resetTongTienVaSoLuong() {
            var soluongElements = document.getElementsByClassName("soluong");
            var tienElements = document.getElementsByClassName("tien");
            for (var i = 0; i < soluongElements.length; i++) {
                soluongElements[i].innerText = "0";
                tienElements[i].innerText = "0";
            }
            tinhtien();
        }

    </script>
</head>

<body>
<div class="container">
    <table>

        <caption>CÁC SẢN PHẨM TRUYỆN</caption>

        <select id="mucgia" onchange="locSanPhamTheoGia()">
            <option value="all">Tất cả</option>
            <option value="duoi500k">Dưới 500,000</option>
            <option value="tu500kden1tr">Từ 500,000 đến 1,000,000</option>
            <option value="tren1tr">Trên 1,000,000</option>
        </select>

        <thead>
            <th><input type="checkbox" id="chon_het"></th>
            <th>Sản phẩm</th>
            <th>Đơn Giá</th>
            <th>Số lượng</th>
            <th>Thành tiền</th>
        </thead>
        <tbody>
            <tr>
                <td><input type="checkbox" class="chon" checked onchange="daott(this)"></td>
                <td class="tensanpham">Truyện Tiên Giả</td>
                <td><div class="dongia" onkeyup="tien(this)">700000</div></td>
                <td><div class="soluong" contenteditable="true" onkeyup="tien(this)">0</div></td>
                <td><div class="tien">0</div></td>
            </tr>

            <tr>
                <td><input type="checkbox" class="chon" checked onchange="daott(this)" ></td>
                <td class="tensanpham">Truyện Quốc Vương</td>
                <td><div class="dongia" onkeyup="tien(this)">800000</div></td>
                <td><div class="soluong" contenteditable="true" onkeyup="tien(this)">0</div></td>
                <td><div class="tien">0</div></td>
            </tr>

            <tr>
                <td><input type="checkbox" class="chon" checked onchange="daott(this)"></td>
                <td class="tensanpham">Đế Bá</td>
                <td><div class="dongia" onkeyup="tien(this)">200000</div></td>
                <td><div class="soluong" contenteditable="true" onkeyup="tien(this)">0</div></td>
                <td><div class="tien">0</div></td>
            </tr>

            <tr>
                <td><input type="checkbox" class="chon" checked onchange="daott(this)"></td>
                <td class="tensanpham">Vạn Cổ Thần Đế</td>
                <td><div class="dongia" onkeyup="tien(this)">300000</div></td>
                <td><div class="soluong" contenteditable="true" onkeyup="tien(this)">0</div></td>
                <td><div class="tien">0</div></td>
            </tr>

            <tr>
                <td colspan="4"><div style="font-weight: 600;">Tổng tiền</div></td>
                <td colspan="2"><div style="font-weight: 600; color: red;" id="tongtien">0</div></td>
            </tr>
         
        </tbody>
    </table>
</div>


  
</body>
</html>